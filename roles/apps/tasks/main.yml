---
# Role: apps
# Grid items: Deploy sample app (2 pts) + Verify Nginx (2 pts)

- name: Copy nginx manifest
  copy:
    src: nginx-app.yml
    dest: /tmp/nginx-app.yml

- name: Deploy nginx application
  command: kubectl apply -f /tmp/nginx-app.yml
  environment:
    KUBECONFIG: /root/.kube/config

# Replaced 'rollout status' with 'pause' to avoid timeouts on slow connections
- name: Wait for nginx to initialize
  pause:
    seconds: 30

- name: Show all pods across all namespaces
  command: kubectl get pods -A -o wide
  environment:
    KUBECONFIG: /root/.kube/config
  register: all_pods

- name: Display all pods
  debug:
    msg: "{{ all_pods.stdout_lines }}"

- name: Final Access Info
  debug:
    msg:
      - "=========================================="
      - "  DEPLOYMENT COMPLETE"
      - "=========================================="
      - "  Nginx App:    http://<NODE_IP>:30080"
      - "  Grafana:      http://<NODE_IP>:32000"
      - "  Alertmanager: http://<NODE_IP>:31000"
      - "=========================================="
