<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>4SAYA K8S Control Center</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #3b82f6; --success: #22c55e; --danger: #ef4444; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 10px; }
        h1 { color: var(--accent); }
        .metric { font-size: 36px; font-weight: bold; margin: 10px 0; }
        .bar-container { width: 100%; height: 10px; background: #334155; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .bar-fill { height: 100%; background: var(--accent); transition: width 0.5s; width: 0%; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        td, th { padding: 8px; text-align: left; border-bottom: 1px solid #334155; }
        .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
</head>
<body>
    <h1>ðŸ¤– 4SAYA-K8S Control Center</h1>
    <div class="grid">
        <div class="card">
            <h2>ðŸ§  HPA Status</h2>
            <div class="metric" id="replicas">--</div>
            <div>Current Replicas</div>
            <div class="bar-container"><div class="bar-fill" id="bar"></div></div>
            <p>Current CPU Load: <span id="load">--</span>% (Target: 50%)</p>
        </div>
        <div class="card">
            <h2>ðŸ“¦ Total Pods</h2>
            <div class="metric" id="pod-count">--</div>
            <div>Running Pods</div>
        </div>
    </div>

    <div class="card" style="margin-top: 20px;">
        <h2>ðŸš€ Active Pods</h2>
        <table id="pod-table">
            <thead><tr><th>Name</th><th>Status</th><th>Node</th><th>IP</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        async function update() {
            try {
                const res = await fetch('data.json');
                const data = await res.json();

                // HPA Logic
                const hpaStatus = data.hpa.status || {};
                const currentRep = hpaStatus.currentReplicas || 0;
                const maxRep = data.hpa.spec?.maxReplicas || 10;
                const util = hpaStatus.currentMetrics?.[0]?.resource?.current?.averageUtilization || 0;

                document.getElementById('replicas').innerText = currentRep;
                document.getElementById('load').innerText = util;

                // Update Bar
                const width = (currentRep / maxRep) * 100;
                const bar = document.getElementById('bar');
                bar.style.width = width + '%';
                bar.style.background = util > 50 ? 'var(--danger)' : 'var(--accent)';

                // Pods Logic
                const pods = data.pods.items || [];
                document.getElementById('pod-count').innerText = pods.length;

                let rows = '';
                pods.forEach(p => {
                    const status = p.status.phase;
                    const color = status === 'Running' ? 'var(--success)' : 'var(--danger)';
                    rows += `<tr>
                        <td>${p.metadata.name}</td>
                        <td><span class="dot" style="background:${color}"></span>${status}</td>
                        <td>${p.spec.nodeName || '-'}</td>
                        <td>${p.status.podIP || '-'}</td>
                    </tr>`;
                });
                document.querySelector('#pod-table tbody').innerHTML = rows;

            } catch (e) {
                console.log("Waiting for data...");
            }
        }
        setInterval(update, 2000); // Update every 2 seconds
        update();
    </script>
</body>
</html>
